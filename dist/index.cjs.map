{"version":3,"sources":["../src/roam-api-adapter.ts","../src/utils.ts","../src/children-reconciler.ts","../src/block-reconciler.ts"],"names":[],"mappings":"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","file":"index.cjs","sourcesContent":["import type { BlockPayload, RoamNode } from \"./types\";\n\n/**\n * Adapter interface for Roam API operations.\n * Abstracts the underlying Roam API to make the reconciler testable.\n */\nexport interface RoamApiAdapter {\n  /**\n   * Gets child blocks of a parent block or page.\n   */\n  getChildren(parentUid: string): RoamNode[];\n\n  /**\n   * Creates a new block under a parent.\n   * @returns The UID of the created block.\n   */\n  createBlock(\n    parentUid: string,\n    block: BlockPayload,\n    order?: number | \"last\"\n  ): Promise<string>;\n\n  /**\n   * Updates the text of an existing block.\n   */\n  updateBlock(uid: string, text: string): Promise<void>;\n\n  /**\n   * Deletes a block by its UID.\n   */\n  deleteBlock(uid: string): Promise<void>;\n}\n\n/**\n * Basic node structure from Roam's API.\n */\nexport interface RoamBasicNode {\n  text?: string;\n  uid: string;\n  children?: RoamBasicNode[];\n}\n\n/**\n * Input node format for creating blocks in Roam.\n */\nexport interface InputTextNode {\n  text: string;\n  children?: InputTextNode[];\n}\n\n/**\n * Options for creating a Roam API adapter.\n */\nexport interface RoamApiAdapterOptions {\n  /**\n   * Function to get child blocks by parent UID.\n   * Should return an array of RoamBasicNode.\n   */\n  getBasicTreeByParentUid: (uid: string) => RoamBasicNode[];\n\n  /**\n   * Function to create a block.\n   * Should return the UID of the created block.\n   */\n  createBlock: (params: {\n    parentUid: string;\n    order: number | \"last\";\n    node: InputTextNode;\n  }) => Promise<string>;\n\n  /**\n   * Function to update a block's text.\n   */\n  updateBlock: (params: { uid: string; text: string }) => Promise<void>;\n\n  /**\n   * Function to delete a block.\n   */\n  deleteBlock: (uid: string) => Promise<void>;\n}\n\n/**\n * Converts a RoamBasicNode to the RoamNode interface used by the reconciler.\n */\nfunction toRoamNode(node: RoamBasicNode): RoamNode {\n  return {\n    text: node.text ?? \"\",\n    uid: node.uid,\n    children: node.children?.map(toRoamNode),\n  };\n}\n\n/**\n * Converts a BlockPayload to the InputTextNode format expected by Roam API.\n */\nfunction toInputNode(payload: BlockPayload): InputTextNode {\n  return {\n    text: payload.text,\n    children: payload.children?.map(toInputNode),\n  };\n}\n\n/**\n * Creates a Roam API adapter with the provided API functions.\n *\n * @example\n * ```typescript\n * const adapter = createRoamApiAdapter({\n *   getBasicTreeByParentUid: (uid) => window.roamAlphaAPI.q(...),\n *   createBlock: async (params) => window.roamAlphaAPI.createBlock(...),\n *   updateBlock: async (params) => window.roamAlphaAPI.updateBlock(...),\n *   deleteBlock: async (uid) => window.roamAlphaAPI.deleteBlock(...),\n * });\n * ```\n */\nexport function createRoamApiAdapter(options: RoamApiAdapterOptions): RoamApiAdapter {\n  return {\n    getChildren(parentUid: string): RoamNode[] {\n      const nodes = options.getBasicTreeByParentUid(parentUid);\n      return nodes.map(toRoamNode);\n    },\n\n    async createBlock(\n      parentUid: string,\n      block: BlockPayload,\n      order: number | \"last\" = \"last\"\n    ): Promise<string> {\n      const uid = await options.createBlock({\n        parentUid,\n        order,\n        node: toInputNode(block),\n      });\n      return uid;\n    },\n\n    async updateBlock(uid: string, text: string): Promise<void> {\n      await options.updateBlock({ uid, text });\n    },\n\n    async deleteBlock(uid: string): Promise<void> {\n      await options.deleteBlock(uid);\n    },\n  };\n}\n","/**\n * Default delay between Roam API mutations in milliseconds.\n */\nexport const DEFAULT_MUTATION_DELAY_MS = 100;\n\n/**\n * Default number of operations before yielding to main thread.\n */\nexport const DEFAULT_YIELD_BATCH_SIZE = 3;\n\n/**\n * Delays execution for the specified number of milliseconds.\n */\nexport function delay(ms: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\n/**\n * Yields to the main thread using scheduler.yield if available,\n * otherwise falls back to setTimeout.\n */\nexport async function yieldToMain(): Promise<void> {\n  const g = globalThis as unknown as { scheduler?: { yield?: () => Promise<void> } };\n  if (typeof g.scheduler?.yield === \"function\") {\n    await g.scheduler.yield();\n  } else {\n    await delay(0);\n  }\n}\n\n/**\n * Conditionally yields to the main thread based on operation count.\n */\nexport async function maybeYield(\n  operationCount: number,\n  batchSize: number = DEFAULT_YIELD_BATCH_SIZE\n): Promise<void> {\n  if (operationCount % batchSize === 0) {\n    await yieldToMain();\n  }\n}\n","import type { BlockPayload, RoamNode, ChildReconcilerConfig, Logger } from \"./types\";\nimport type { RoamApiAdapter } from \"./roam-api-adapter\";\nimport { delay, maybeYield, DEFAULT_MUTATION_DELAY_MS } from \"./utils\";\n\n/**\n * Statistics about a children sync operation.\n */\nexport interface ChildSyncStats {\n  skipped: number;\n  updated: number;\n  created: number;\n  deleted: number;\n}\n\n/**\n * Reconciles child blocks (properties) of a parent block.\n * Updates existing properties, creates new ones, and handles special blocks.\n */\nexport class ChildrenReconciler {\n  private readonly mutationDelayMs: number;\n  private readonly logger: Logger | undefined;\n\n  constructor(\n    private readonly config: ChildReconcilerConfig,\n    private readonly roamApi: RoamApiAdapter\n  ) {\n    this.mutationDelayMs = config.mutationDelayMs ?? DEFAULT_MUTATION_DELAY_MS;\n    this.logger = config.logger;\n  }\n\n  /**\n   * Synchronizes child blocks of a parent.\n   *\n   * @param parentUid UID of the parent block.\n   * @param existingChildren Current child nodes from Roam.\n   * @param newChildren Desired child payloads.\n   * @returns Statistics about the sync.\n   */\n  async syncChildren(\n    parentUid: string,\n    existingChildren: RoamNode[],\n    newChildren: BlockPayload[]\n  ): Promise<ChildSyncStats> {\n    const stats: ChildSyncStats = {\n      skipped: 0,\n      updated: 0,\n      created: 0,\n      deleted: 0,\n    };\n\n    // Build map of existing property blocks by key\n    const existingPropsMap = new Map<string, RoamNode>();\n    const existingSpecialBlocks: RoamNode[] = [];\n\n    for (const child of existingChildren) {\n      const key = this.config.extractKey(child.text);\n      if (key) {\n        existingPropsMap.set(key, child);\n      } else if (this.config.isSpecialBlock?.(child.text)) {\n        existingSpecialBlocks.push(child);\n      }\n    }\n\n    this.logger?.debug(\"children_reconciler_start\", {\n      parentUid,\n      existingPropsCount: existingPropsMap.size,\n      existingSpecialCount: existingSpecialBlocks.length,\n      newChildrenCount: newChildren.length,\n    });\n\n    let operationCount = 0;\n\n    // Process new children\n    for (const newChild of newChildren) {\n      const key = this.config.extractKey(newChild.text);\n\n      if (key) {\n        // It's a property block\n        const existing = existingPropsMap.get(key);\n\n        if (existing) {\n          // Update if changed\n          if (existing.text === newChild.text) {\n            stats.skipped++;\n            this.logger?.debug(\"children_reconciler_skip\", { key, reason: \"unchanged\" });\n          } else {\n            await this.roamApi.updateBlock(existing.uid, newChild.text);\n            await delay(this.mutationDelayMs);\n            stats.updated++;\n            this.logger?.debug(\"children_reconciler_update\", { key, uid: existing.uid });\n          }\n          existingPropsMap.delete(key); // Mark as processed\n        } else {\n          // Create new property\n          await this.roamApi.createBlock(parentUid, newChild, \"last\");\n          await delay(this.mutationDelayMs);\n          stats.created++;\n          this.logger?.debug(\"children_reconciler_create\", { key });\n        }\n      } else if (this.config.isSpecialBlock?.(newChild.text)) {\n        // It's a special block (e.g., comment wrapper)\n        // Delete all existing special blocks and recreate\n        for (const specialBlock of existingSpecialBlocks) {\n          await this.roamApi.deleteBlock(specialBlock.uid);\n          await delay(this.mutationDelayMs);\n          stats.deleted++;\n          this.logger?.debug(\"children_reconciler_delete_special\", { uid: specialBlock.uid });\n        }\n        existingSpecialBlocks.length = 0; // Clear to avoid re-deleting\n\n        // Create the new special block\n        await this.roamApi.createBlock(parentUid, newChild, \"last\");\n        await delay(this.mutationDelayMs);\n        stats.created++;\n        this.logger?.debug(\"children_reconciler_create_special\", { text: newChild.text.substring(0, 30) });\n      }\n\n      operationCount++;\n      await maybeYield(operationCount);\n    }\n\n    // Delete orphaned property blocks that are no longer in the desired state\n    for (const [key, orphanBlock] of existingPropsMap) {\n      await delay(this.mutationDelayMs);\n      await this.roamApi.deleteBlock(orphanBlock.uid);\n      stats.deleted++;\n      this.logger?.debug(\"children_reconciler_delete_orphan\", { key, uid: orphanBlock.uid });\n\n      operationCount++;\n      await maybeYield(operationCount);\n    }\n\n    this.logger?.debug(\"children_reconciler_complete\", { ...stats });\n    return stats;\n  }\n}\n","import type {\n  BlockPayload,\n  RoamNode,\n  ReconcilerConfig,\n  SyncStats,\n  ChildReconcilerConfig,\n  Logger,\n} from \"./types\";\nimport type { RoamApiAdapter } from \"./roam-api-adapter\";\nimport { delay, yieldToMain, DEFAULT_MUTATION_DELAY_MS, DEFAULT_YIELD_BATCH_SIZE } from \"./utils\";\nimport { ChildrenReconciler } from \"./children-reconciler\";\n\n/**\n * Reconciles a list of source items with existing Roam blocks.\n * Only creates, updates, or deletes blocks when necessary.\n */\nexport class BlockReconciler<T> {\n  private readonly mutationDelayMs: number;\n  private readonly yieldBatchSize: number;\n  private readonly logger: Logger | undefined;\n  private childrenReconciler: ChildrenReconciler | null = null;\n\n  constructor(\n    private readonly config: ReconcilerConfig<T>,\n    private readonly roamApi: RoamApiAdapter\n  ) {\n    this.mutationDelayMs = config.options?.mutationDelayMs ?? DEFAULT_MUTATION_DELAY_MS;\n    this.yieldBatchSize = config.options?.yieldBatchSize ?? DEFAULT_YIELD_BATCH_SIZE;\n    this.logger = config.options?.logger;\n  }\n\n  /**\n   * Sets up the children reconciler for syncing child blocks (properties).\n   */\n  withChildrenReconciler(config: ChildReconcilerConfig): this {\n    this.childrenReconciler = new ChildrenReconciler(\n      { ...config, logger: config.logger ?? this.logger },\n      this.roamApi\n    );\n    return this;\n  }\n\n  /**\n   * Reconciles items with existing blocks under a parent.\n   *\n   * @param parentUid UID of the parent block or page.\n   * @param items Source items to reconcile.\n   * @returns Statistics about the sync operation.\n   */\n  async reconcile(parentUid: string, items: T[]): Promise<SyncStats> {\n    const stats: SyncStats = {\n      total: items.length,\n      skipped: 0,\n      created: 0,\n      updated: 0,\n      deleted: 0,\n    };\n\n    // Get existing blocks\n    const existingNodes = this.roamApi.getChildren(parentUid);\n    const existingMap = this.buildExistingMap(existingNodes);\n\n    this.logger?.debug(\"reconciler_start\", {\n      parentUid,\n      itemCount: items.length,\n      existingBlockCount: existingNodes.length,\n      mappedBlockCount: existingMap.size,\n    });\n\n    // Track which IDs we've seen\n    const seenIds = new Set<string>();\n    let operationCount = 0;\n\n    // Process each item\n    for (const item of items) {\n      const id = this.config.extractId(item);\n      seenIds.add(id);\n\n      const newBlock = this.config.buildBlock(item);\n      const existingNode = existingMap.get(id);\n\n      if (existingNode) {\n        // Block exists - check if it changed\n        const unchanged = this.isUnchanged(existingNode, newBlock);\n\n        if (unchanged) {\n          stats.skipped++;\n          this.logger?.debug(\"reconciler_skip\", { id, reason: \"unchanged\" });\n        } else {\n          await this.updateExistingBlock(existingNode, newBlock);\n          stats.updated++;\n          this.logger?.debug(\"reconciler_update\", { id, uid: existingNode.uid });\n        }\n      } else {\n        // Block doesn't exist - create it\n        await this.createNewBlock(parentUid, newBlock);\n        stats.created++;\n        this.logger?.debug(\"reconciler_create\", { id });\n      }\n\n      operationCount++;\n      await this.maybeYieldToMain(operationCount);\n      this.config.options?.onProgress?.(stats);\n    }\n\n    // Remove obsolete blocks\n    stats.deleted = await this.removeObsolete(existingMap, seenIds);\n\n    this.logger?.debug(\"reconciler_complete\", { ...stats });\n    return stats;\n  }\n\n  /**\n   * Builds a map of existing blocks by their extracted ID.\n   */\n  private buildExistingMap(nodes: RoamNode[]): Map<string, RoamNode> {\n    const map = new Map<string, RoamNode>();\n\n    for (const node of nodes) {\n      const id = this.config.extractIdFromBlock(node);\n      if (id) {\n        map.set(id, node);\n        this.logger?.debug(\"reconciler_map_entry\", { id, uid: node.uid });\n      }\n    }\n\n    return map;\n  }\n\n  /**\n   * Compares an existing block with a new block payload.\n   * Returns true if they are equivalent (no update needed).\n   */\n  private isUnchanged(existing: RoamNode, newBlock: BlockPayload): boolean {\n    // Compare main text\n    if (existing.text !== newBlock.text) {\n      return false;\n    }\n\n    // Compare children count\n    const existingChildren = existing.children ?? [];\n    const newChildren = newBlock.children ?? [];\n\n    if (existingChildren.length !== newChildren.length) {\n      return false;\n    }\n\n    // Recursively compare children\n    for (let i = 0; i < existingChildren.length; i++) {\n      const existingChild = existingChildren[i];\n      const newChild = newChildren[i];\n\n      if (!this.isChildUnchanged(existingChild, newChild)) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Compares a single child node with a new child payload.\n   */\n  private isChildUnchanged(existing: RoamNode, newChild: BlockPayload): boolean {\n    if (existing.text !== newChild.text) {\n      return false;\n    }\n\n    const existingChildren = existing.children ?? [];\n    const newChildren = newChild.children ?? [];\n\n    if (existingChildren.length !== newChildren.length) {\n      return false;\n    }\n\n    for (let i = 0; i < existingChildren.length; i++) {\n      if (!this.isChildUnchanged(existingChildren[i], newChildren[i])) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Updates an existing block and its children.\n   */\n  private async updateExistingBlock(\n    existing: RoamNode,\n    newBlock: BlockPayload\n  ): Promise<void> {\n    // Update main text if changed\n    if (existing.text !== newBlock.text) {\n      await this.roamApi.updateBlock(existing.uid, newBlock.text);\n      await delay(this.mutationDelayMs);\n    }\n\n    // Sync children if reconciler is configured\n    if (this.childrenReconciler && newBlock.children) {\n      await this.childrenReconciler.syncChildren(\n        existing.uid,\n        existing.children ?? [],\n        newBlock.children\n      );\n    }\n  }\n\n  /**\n   * Creates a new block with its children.\n   */\n  private async createNewBlock(\n    parentUid: string,\n    block: BlockPayload\n  ): Promise<void> {\n    // createBlock in roam-api-adapter already handles children recursively\n    await this.roamApi.createBlock(parentUid, block, \"last\");\n  }\n\n  /**\n   * Removes blocks that are no longer in the source list.\n   * Respects the preserveWhen option.\n   */\n  private async removeObsolete(\n    existingMap: Map<string, RoamNode>,\n    seenIds: Set<string>\n  ): Promise<number> {\n    let deletedCount = 0;\n    let operationCount = 0;\n\n    for (const [id, node] of existingMap.entries()) {\n      // Skip if we processed this ID\n      if (seenIds.has(id)) {\n        continue;\n      }\n\n      // Check if block should be preserved\n      if (this.config.options?.preserveWhen?.(node)) {\n        this.logger?.debug(\"reconciler_preserve\", { id, uid: node.uid });\n        continue;\n      }\n\n      // Delete the block\n      await this.roamApi.deleteBlock(node.uid);\n      await delay(this.mutationDelayMs);\n      deletedCount++;\n\n      this.logger?.debug(\"reconciler_delete\", { id, uid: node.uid });\n\n      operationCount++;\n      await this.maybeYieldToMain(operationCount);\n    }\n\n    return deletedCount;\n  }\n\n  /**\n   * Yields to the main thread periodically based on the configured batch size.\n   */\n  private async maybeYieldToMain(count: number): Promise<void> {\n    if (count % this.yieldBatchSize === 0) {\n      await yieldToMain();\n    }\n  }\n}\n"]}